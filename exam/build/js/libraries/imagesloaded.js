"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){"function"==typeof define&&define.amd?define(["ev-emitter/ev-emitter"],function(i){return e(t,i)}):"object"==("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e(t,require("ev-emitter")):t.imagesLoaded=e(t,t.EvEmitter)}("undefined"!=typeof window?window:void 0,function(t,e){function i(t,e){for(var i in e)t[i]=e[i];return t}function o(t,e,n){if(!(this instanceof o))return new o(t,e,n);"string"==typeof t&&(t=document.querySelectorAll(t)),this.elements=function(t){var e=[];if(Array.isArray(t))e=t;else if("number"==typeof t.length)for(var i=0;i<t.length;i++)e.push(t[i]);else e.push(t);return e}(t),this.options=i({},this.options),"function"==typeof e?n=e:i(this.options,e),n&&this.on("always",n),this.getImages(),s&&(this.jqDeferred=new s.Deferred),setTimeout(function(){this.check()}.bind(this))}function n(t){this.img=t}function r(t,e){this.url=t,this.element=e,this.img=new Image}var s=t.jQuery,h=t.console;(o.prototype=Object.create(e.prototype)).options={},o.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},o.prototype.addElementImages=function(t){"IMG"==t.nodeName&&this.addImage(t),!0===this.options.background&&this.addElementBackgroundImages(t);var e=t.nodeType;if(e&&a[e]){for(var i=t.querySelectorAll("img"),o=0;o<i.length;o++){var n=i[o];this.addImage(n)}if("string"==typeof this.options.background){var r=t.querySelectorAll(this.options.background);for(o=0;o<r.length;o++){var s=r[o];this.addElementBackgroundImages(s)}}}};var a={1:!0,9:!0,11:!0};return o.prototype.addElementBackgroundImages=function(t){var e=getComputedStyle(t);if(e)for(var i=/url\((['"])?(.*?)\1\)/gi,o=i.exec(e.backgroundImage);null!==o;){var n=o&&o[2];n&&this.addBackground(n,t),o=i.exec(e.backgroundImage)}},o.prototype.addImage=function(t){var e=new n(t);this.images.push(e)},o.prototype.addBackground=function(t,e){var i=new r(t,e);this.images.push(i)},o.prototype.check=function(){function t(t,i,o){setTimeout(function(){e.progress(t,i,o)})}var e=this;this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?this.images.forEach(function(e){e.once("progress",t),e.check()}):this.complete()},o.prototype.progress=function(t,e,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!t.isLoaded,this.emitEvent("progress",[this,t,e]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,t),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&h&&h.log("progress: "+i,t,e)},o.prototype.complete=function(){var t=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(t,[this]),this.emitEvent("always",[this]),this.jqDeferred){var e=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[e](this)}},n.prototype=Object.create(e.prototype),n.prototype.check=function(){this.getIsImageComplete()?this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.proxyImage.src=this.img.src)},n.prototype.getIsImageComplete=function(){return this.img.complete&&void 0!==this.img.naturalWidth},n.prototype.confirm=function(t,e){this.isLoaded=t,this.emitEvent("progress",[this,this.img,e])},n.prototype.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},n.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},n.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},n.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},r.prototype=Object.create(n.prototype),r.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url;this.getIsImageComplete()&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},r.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},r.prototype.confirm=function(t,e){this.isLoaded=t,this.emitEvent("progress",[this,this.element,e])},o.makeJQueryPlugin=function(e){(e=e||t.jQuery)&&((s=e).fn.imagesLoaded=function(t,e){return new o(this,t,e).jqDeferred.promise(s(this))})},o.makeJQueryPlugin(),o});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYnJhcmllcy9pbWFnZXNsb2FkZWQuanMiXSwibmFtZXMiOlsid2luZG93IiwiZmFjdG9yeSIsImRlZmluZSIsImFtZCIsIkV2RW1pdHRlciIsIm1vZHVsZSIsIl90eXBlb2YiLCJleHBvcnRzIiwicmVxdWlyZSIsImltYWdlc0xvYWRlZCIsInVuZGVmaW5lZCIsImpRdWVyeSIsImV4dGVuZCIsImEiLCJiIiwicHJvcCIsIkltYWdlc0xvYWRlZCIsImVsZW0iLCJvcHRpb25zIiwib25BbHdheXMiLCJ0aGlzIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwibWFrZUFycmF5IiwiZWxlbWVudHMiLCJhcnkiLCJvYmoiLCJBcnJheSIsImlzQXJyYXkiLCJsZW5ndGgiLCJpIiwicHVzaCIsIm9uIiwiZ2V0SW1hZ2VzIiwiJCIsInNldFRpbWVvdXQiLCJEZWZlcnJlZCIsImJpbmQiLCJMb2FkaW5nSW1hZ2UiLCJwcm90b3R5cGUiLCJpbWciLCJCYWNrZ3JvdW5kIiwidXJsIiwiZWxlbWVudCIsImNvbnNvbGUiLCJmb3JFYWNoIiwiYWRkRWxlbWVudEltYWdlcyIsImltYWdlcyIsImJhY2tncm91bmQiLCJub2RlTmFtZSIsImFkZEltYWdlIiwiYWRkRWxlbWVudEJhY2tncm91bmRJbWFnZXMiLCJub2RlVHlwZSIsImNoaWxkSW1ncyIsImVsZW1lbnROb2RlVHlwZXMiLCJjaGlsZCIsImNoaWxkcmVuIiwiMSIsIjExIiwic3R5bGUiLCJnZXRDb21wdXRlZFN0eWxlIiwicmVVUkwiLCJtYXRjaGVzIiwiYWRkQmFja2dyb3VuZCIsImV4ZWMiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJfdGhpcyIsImNoZWNrIiwib25Qcm9ncmVzcyIsImltYWdlIiwibWVzc2FnZSIsImxvYWRpbmdJbWFnZSIsInByb2dyZXNzZWRDb3VudCIsImhhc0FueUJyb2tlbiIsIm9uY2UiLCJjb21wbGV0ZSIsImVtaXRFdmVudCIsInByb2dyZXNzIiwibm90aWZ5IiwiaXNMb2FkZWQiLCJqcURlZmVycmVkIiwiZGVidWciLCJldmVudE5hbWUiLCJpc0NvbXBsZXRlIiwianFNZXRob2QiLCJPYmplY3QiLCJjcmVhdGUiLCJnZXRJc0ltYWdlQ29tcGxldGUiLCJjb25maXJtIiwibmF0dXJhbFdpZHRoIiwicHJveHlJbWFnZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJzcmMiLCJoYW5kbGVFdmVudCIsImV2ZW50IiwibWV0aG9kIiwidHlwZSIsIm9ubG9hZCIsInVuYmluZEV2ZW50cyIsIm9uZXJyb3IiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwibWFrZUpRdWVyeVBsdWdpbiIsImZuIiwiY2FsbGJhY2siLCJwcm9taXNlIl0sIm1hcHBpbmdzIjoib09BTUEsU0FBWUEsRUFBUUMsR0FBWSxtQkFBQUMsUUFBQUEsT0FBQUMsSUFPNUJELFFBSkYseUJBTUssU0FBVUUsR0FKVixPQUFPRixFQUFQRixFQUFpQkksS0FHbEIsV0FBQSxvQkFBQUMsT0FBQSxZQUFBQyxRQUFBRCxVQUNDQSxPQUFVRCxRQUVaQyxPQUpERSxRQUFBTixFQUZGRCxFQVFFUSxRQUFBLGVBT0FSLEVBQU9TLGFBQWVSLEVBSXZCRCxFQUVDQSxFQUFPQSxXQTFCWCxDQThCa0JBLG9CQUFUQyxPQUE2QkQsWUFBdENVLEVBSUEsU0FBZUMsRUFBZlAsR0FVRSxTQUFBUSxFQUFBQyxFQUFBQyxHQUNELElBQUEsSUFBQUMsS0FBQUQsRUFIR0QsRUFBR0UsR0FBU0QsRUFBR0MsR0FNbkIsT0FBQUYsRUE0QkcsU0FBQUcsRUFBQUMsRUFBQUMsRUFBQUMsR0FFRCxLQUFLQyxnQkFBZUosR0FDbEJDLE9BQUFBLElBQU9JLEVBQVNDLEVBQUFBLEVBQWhCSCxHQUdjSSxpQkFBWEMsSUFDTFAsRUFBS0MsU0FBVU4saUJBQWlCTSxJQUc5QkMsS0FBQUEsU0FsQ0FNLFNBQUFDLEdBQ0QsSUFIREQsS0FJRSxHQUFBRSxNQUFBQyxRQUFBRixHQUVFRCxFQUFBQSxPQUNELEdBQUEsaUJBQUFDLEVBQUFHLE9BRUQsSUFBQSxJQUFBQyxFQUFBLEVBQUFBLEVB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QW9CLElBQUt1QyxvQkFBTCxRQUFBM0QsT0FERnFCLEVBQVdGLFVBQVVpRCxRQUFVLFNBQVVULEVBQVVULEdBS25EbEQsS0FBQTJELFNBQUFBLEVBSEUzRCxLQUFLd0QsVUFBVyxZQUFjeEQsS0FBTUEsS0FBS3VCLFFBQVMyQixLQVNqRHRELEVBQUFxRixpQkFBQSxTQUFBMUYsSUFDREEsRUFBQUEsR0FBQVgsRUFBQVcsV0FLRXVCLEVBQUF2QixHQVZKMkYsR0FBQTdGLGFBQUEsU0FBQVMsRUFBQXFGLEdBY0F2RixPQURBLElBQUFBLEVBQUFJLEtBQUFGLEVBQUFxRixHQUNhRixXQUFiRyxRQUFBdEUsRUFBQWQsVUFJQUosRUFBT0EsbUJBQUFBIiwiZmlsZSI6ImxpYnJhcmllcy9pbWFnZXNsb2FkZWQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIGltYWdlc0xvYWRlZCB2NC4xLjNcbiAqIEphdmFTY3JpcHQgaXMgYWxsIGxpa2UgXCJZb3UgaW1hZ2VzIGFyZSBkb25lIHlldCBvciB3aGF0P1wiXG4gKiBNSVQgTGljZW5zZVxuICovXG5cbiggZnVuY3Rpb24oIHdpbmRvdywgZmFjdG9yeSApIHsgJ3VzZSBzdHJpY3QnO1xuICAvLyB1bml2ZXJzYWwgbW9kdWxlIGRlZmluaXRpb25cblxuICAvKmdsb2JhbCBkZWZpbmU6IGZhbHNlLCBtb2R1bGU6IGZhbHNlLCByZXF1aXJlOiBmYWxzZSAqL1xuXG4gIGlmICggdHlwZW9mIGRlZmluZSA9PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQgKSB7XG4gICAgLy8gQU1EXG4gICAgZGVmaW5lKCBbXG4gICAgICAnZXYtZW1pdHRlci9ldi1lbWl0dGVyJ1xuICAgIF0sIGZ1bmN0aW9uKCBFdkVtaXR0ZXIgKSB7XG4gICAgICByZXR1cm4gZmFjdG9yeSggd2luZG93LCBFdkVtaXR0ZXIgKTtcbiAgICB9KTtcbiAgfSBlbHNlIGlmICggdHlwZW9mIG1vZHVsZSA9PSAnb2JqZWN0JyAmJiBtb2R1bGUuZXhwb3J0cyApIHtcbiAgICAvLyBDb21tb25KU1xuICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShcbiAgICAgIHdpbmRvdyxcbiAgICAgIHJlcXVpcmUoJ2V2LWVtaXR0ZXInKVxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgLy8gYnJvd3NlciBnbG9iYWxcbiAgICB3aW5kb3cuaW1hZ2VzTG9hZGVkID0gZmFjdG9yeShcbiAgICAgIHdpbmRvdyxcbiAgICAgIHdpbmRvdy5FdkVtaXR0ZXJcbiAgICApO1xuICB9XG5cbn0pKCB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHRoaXMsXG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICBmYWN0b3J5IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vXG5cbmZ1bmN0aW9uIGZhY3RvcnkoIHdpbmRvdywgRXZFbWl0dGVyICkge1xuXG4ndXNlIHN0cmljdCc7XG5cbnZhciAkID0gd2luZG93LmpRdWVyeTtcbnZhciBjb25zb2xlID0gd2luZG93LmNvbnNvbGU7XG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIGhlbHBlcnMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cblxuLy8gZXh0ZW5kIG9iamVjdHNcbmZ1bmN0aW9uIGV4dGVuZCggYSwgYiApIHtcbiAgZm9yICggdmFyIHByb3AgaW4gYiApIHtcbiAgICBhWyBwcm9wIF0gPSBiWyBwcm9wIF07XG4gIH1cbiAgcmV0dXJuIGE7XG59XG5cbi8vIHR1cm4gZWxlbWVudCBvciBub2RlTGlzdCBpbnRvIGFuIGFycmF5XG5mdW5jdGlvbiBtYWtlQXJyYXkoIG9iaiApIHtcbiAgdmFyIGFyeSA9IFtdO1xuICBpZiAoIEFycmF5LmlzQXJyYXkoIG9iaiApICkge1xuICAgIC8vIHVzZSBvYmplY3QgaWYgYWxyZWFkeSBhbiBhcnJheVxuICAgIGFyeSA9IG9iajtcbiAgfSBlbHNlIGlmICggdHlwZW9mIG9iai5sZW5ndGggPT0gJ251bWJlcicgKSB7XG4gICAgLy8gY29udmVydCBub2RlTGlzdCB0byBhcnJheVxuICAgIGZvciAoIHZhciBpPTA7IGkgPCBvYmoubGVuZ3RoOyBpKysgKSB7XG4gICAgICBhcnkucHVzaCggb2JqW2ldICk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIC8vIGFycmF5IG9mIHNpbmdsZSBpbmRleFxuICAgIGFyeS5wdXNoKCBvYmogKTtcbiAgfVxuICByZXR1cm4gYXJ5O1xufVxuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBpbWFnZXNMb2FkZWQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cblxuLyoqXG4gKiBAcGFyYW0ge0FycmF5LCBFbGVtZW50LCBOb2RlTGlzdCwgU3RyaW5nfSBlbGVtXG4gKiBAcGFyYW0ge09iamVjdCBvciBGdW5jdGlvbn0gb3B0aW9ucyAtIGlmIGZ1bmN0aW9uLCB1c2UgYXMgY2FsbGJhY2tcbiAqIEBwYXJhbSB7RnVuY3Rpb259IG9uQWx3YXlzIC0gY2FsbGJhY2sgZnVuY3Rpb25cbiAqL1xuZnVuY3Rpb24gSW1hZ2VzTG9hZGVkKCBlbGVtLCBvcHRpb25zLCBvbkFsd2F5cyApIHtcbiAgLy8gY29lcmNlIEltYWdlc0xvYWRlZCgpIHdpdGhvdXQgbmV3LCB0byBiZSBuZXcgSW1hZ2VzTG9hZGVkKClcbiAgaWYgKCAhKCB0aGlzIGluc3RhbmNlb2YgSW1hZ2VzTG9hZGVkICkgKSB7XG4gICAgcmV0dXJuIG5ldyBJbWFnZXNMb2FkZWQoIGVsZW0sIG9wdGlvbnMsIG9uQWx3YXlzICk7XG4gIH1cbiAgLy8gdXNlIGVsZW0gYXMgc2VsZWN0b3Igc3RyaW5nXG4gIGlmICggdHlwZW9mIGVsZW0gPT0gJ3N0cmluZycgKSB7XG4gICAgZWxlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIGVsZW0gKTtcbiAgfVxuXG4gIHRoaXMuZWxlbWVudHMgPSBtYWtlQXJyYXkoIGVsZW0gKTtcbiAgdGhpcy5vcHRpb25zID0gZXh0ZW5kKCB7fSwgdGhpcy5vcHRpb25zICk7XG5cbiAgaWYgKCB0eXBlb2Ygb3B0aW9ucyA9PSAnZnVuY3Rpb24nICkge1xuICAgIG9uQWx3YXlzID0gb3B0aW9ucztcbiAgfSBlbHNlIHtcbiAgICBleHRlbmQoIHRoaXMub3B0aW9ucywgb3B0aW9ucyApO1xuICB9XG5cbiAgaWYgKCBvbkFsd2F5cyApIHtcbiAgICB0aGlzLm9uKCAnYWx3YXlzJywgb25BbHdheXMgKTtcbiAgfVxuXG4gIHRoaXMuZ2V0SW1hZ2VzKCk7XG5cbiAgaWYgKCAkICkge1xuICAgIC8vIGFkZCBqUXVlcnkgRGVmZXJyZWQgb2JqZWN0XG4gICAgdGhpcy5qcURlZmVycmVkID0gbmV3ICQuRGVmZXJyZWQoKTtcbiAgfVxuXG4gIC8vIEhBQ0sgY2hlY2sgYXN5bmMgdG8gYWxsb3cgdGltZSB0byBiaW5kIGxpc3RlbmVyc1xuICBzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNoZWNrKCk7XG4gIH0uYmluZCggdGhpcyApKTtcbn1cblxuSW1hZ2VzTG9hZGVkLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEV2RW1pdHRlci5wcm90b3R5cGUgKTtcblxuSW1hZ2VzTG9hZGVkLnByb3RvdHlwZS5vcHRpb25zID0ge307XG5cbkltYWdlc0xvYWRlZC5wcm90b3R5cGUuZ2V0SW1hZ2VzID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuaW1hZ2VzID0gW107XG5cbiAgLy8gZmlsdGVyICYgZmluZCBpdGVtcyBpZiB3ZSBoYXZlIGFuIGl0ZW0gc2VsZWN0b3JcbiAgdGhpcy5lbGVtZW50cy5mb3JFYWNoKCB0aGlzLmFkZEVsZW1lbnRJbWFnZXMsIHRoaXMgKTtcbn07XG5cbi8qKlxuICogQHBhcmFtIHtOb2RlfSBlbGVtZW50XG4gKi9cbkltYWdlc0xvYWRlZC5wcm90b3R5cGUuYWRkRWxlbWVudEltYWdlcyA9IGZ1bmN0aW9uKCBlbGVtICkge1xuICAvLyBmaWx0ZXIgc2libGluZ3NcbiAgaWYgKCBlbGVtLm5vZGVOYW1lID09ICdJTUcnICkge1xuICAgIHRoaXMuYWRkSW1hZ2UoIGVsZW0gKTtcbiAgfVxuICAvLyBnZXQgYmFja2dyb3VuZCBpbWFnZSBvbiBlbGVtZW50XG4gIGlmICggdGhpcy5vcHRpb25zLmJhY2tncm91bmQgPT09IHRydWUgKSB7XG4gICAgdGhpcy5hZGRFbGVtZW50QmFja2dyb3VuZEltYWdlcyggZWxlbSApO1xuICB9XG5cbiAgLy8gZmluZCBjaGlsZHJlblxuICAvLyBubyBub24tZWxlbWVudCBub2RlcywgIzE0M1xuICB2YXIgbm9kZVR5cGUgPSBlbGVtLm5vZGVUeXBlO1xuICBpZiAoICFub2RlVHlwZSB8fCAhZWxlbWVudE5vZGVUeXBlc1sgbm9kZVR5cGUgXSApIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIGNoaWxkSW1ncyA9IGVsZW0ucXVlcnlTZWxlY3RvckFsbCgnaW1nJyk7XG4gIC8vIGNvbmNhdCBjaGlsZEVsZW1zIHRvIGZpbHRlckZvdW5kIGFycmF5XG4gIGZvciAoIHZhciBpPTA7IGkgPCBjaGlsZEltZ3MubGVuZ3RoOyBpKysgKSB7XG4gICAgdmFyIGltZyA9IGNoaWxkSW1nc1tpXTtcbiAgICB0aGlzLmFkZEltYWdlKCBpbWcgKTtcbiAgfVxuXG4gIC8vIGdldCBjaGlsZCBiYWNrZ3JvdW5kIGltYWdlc1xuICBpZiAoIHR5cGVvZiB0aGlzLm9wdGlvbnMuYmFja2dyb3VuZCA9PSAnc3RyaW5nJyApIHtcbiAgICB2YXIgY2hpbGRyZW4gPSBlbGVtLnF1ZXJ5U2VsZWN0b3JBbGwoIHRoaXMub3B0aW9ucy5iYWNrZ3JvdW5kICk7XG4gICAgZm9yICggaT0wOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKysgKSB7XG4gICAgICB2YXIgY2hpbGQgPSBjaGlsZHJlbltpXTtcbiAgICAgIHRoaXMuYWRkRWxlbWVudEJhY2tncm91bmRJbWFnZXMoIGNoaWxkICk7XG4gICAgfVxuICB9XG59O1xuXG52YXIgZWxlbWVudE5vZGVUeXBlcyA9IHtcbiAgMTogdHJ1ZSxcbiAgOTogdHJ1ZSxcbiAgMTE6IHRydWVcbn07XG5cbkltYWdlc0xvYWRlZC5wcm90b3R5cGUuYWRkRWxlbWVudEJhY2tncm91bmRJbWFnZXMgPSBmdW5jdGlvbiggZWxlbSApIHtcbiAgdmFyIHN0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZSggZWxlbSApO1xuICBpZiAoICFzdHlsZSApIHtcbiAgICAvLyBGaXJlZm94IHJldHVybnMgbnVsbCBpZiBpbiBhIGhpZGRlbiBpZnJhbWUgaHR0cHM6Ly9idWd6aWwubGEvNTQ4Mzk3XG4gICAgcmV0dXJuO1xuICB9XG4gIC8vIGdldCB1cmwgaW5zaWRlIHVybChcIi4uLlwiKVxuICB2YXIgcmVVUkwgPSAvdXJsXFwoKFsnXCJdKT8oLio/KVxcMVxcKS9naTtcbiAgdmFyIG1hdGNoZXMgPSByZVVSTC5leGVjKCBzdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgKTtcbiAgd2hpbGUgKCBtYXRjaGVzICE9PSBudWxsICkge1xuICAgIHZhciB1cmwgPSBtYXRjaGVzICYmIG1hdGNoZXNbMl07XG4gICAgaWYgKCB1cmwgKSB7XG4gICAgICB0aGlzLmFkZEJhY2tncm91bmQoIHVybCwgZWxlbSApO1xuICAgIH1cbiAgICBtYXRjaGVzID0gcmVVUkwuZXhlYyggc3R5bGUuYmFja2dyb3VuZEltYWdlICk7XG4gIH1cbn07XG5cbi8qKlxuICogQHBhcmFtIHtJbWFnZX0gaW1nXG4gKi9cbkltYWdlc0xvYWRlZC5wcm90b3R5cGUuYWRkSW1hZ2UgPSBmdW5jdGlvbiggaW1nICkge1xuICB2YXIgbG9hZGluZ0ltYWdlID0gbmV3IExvYWRpbmdJbWFnZSggaW1nICk7XG4gIHRoaXMuaW1hZ2VzLnB1c2goIGxvYWRpbmdJbWFnZSApO1xufTtcblxuSW1hZ2VzTG9hZGVkLnByb3RvdHlwZS5hZGRCYWNrZ3JvdW5kID0gZnVuY3Rpb24oIHVybCwgZWxlbSApIHtcbiAgdmFyIGJhY2tncm91bmQgPSBuZXcgQmFja2dyb3VuZCggdXJsLCBlbGVtICk7XG4gIHRoaXMuaW1hZ2VzLnB1c2goIGJhY2tncm91bmQgKTtcbn07XG5cbkltYWdlc0xvYWRlZC5wcm90b3R5cGUuY2hlY2sgPSBmdW5jdGlvbigpIHtcbiAgdmFyIF90aGlzID0gdGhpcztcbiAgdGhpcy5wcm9ncmVzc2VkQ291bnQgPSAwO1xuICB0aGlzLmhhc0FueUJyb2tlbiA9IGZhbHNlO1xuICAvLyBjb21wbGV0ZSBpZiBubyBpbWFnZXNcbiAgaWYgKCAhdGhpcy5pbWFnZXMubGVuZ3RoICkge1xuICAgIHRoaXMuY29tcGxldGUoKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBmdW5jdGlvbiBvblByb2dyZXNzKCBpbWFnZSwgZWxlbSwgbWVzc2FnZSApIHtcbiAgICAvLyBIQUNLIC0gQ2hyb21lIHRyaWdnZXJzIGV2ZW50IGJlZm9yZSBvYmplY3QgcHJvcGVydGllcyBoYXZlIGNoYW5nZWQuICM4M1xuICAgIHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkge1xuICAgICAgX3RoaXMucHJvZ3Jlc3MoIGltYWdlLCBlbGVtLCBtZXNzYWdlICk7XG4gICAgfSk7XG4gIH1cblxuICB0aGlzLmltYWdlcy5mb3JFYWNoKCBmdW5jdGlvbiggbG9hZGluZ0ltYWdlICkge1xuICAgIGxvYWRpbmdJbWFnZS5vbmNlKCAncHJvZ3Jlc3MnLCBvblByb2dyZXNzICk7XG4gICAgbG9hZGluZ0ltYWdlLmNoZWNrKCk7XG4gIH0pO1xufTtcblxuSW1hZ2VzTG9hZGVkLnByb3RvdHlwZS5wcm9ncmVzcyA9IGZ1bmN0aW9uKCBpbWFnZSwgZWxlbSwgbWVzc2FnZSApIHtcbiAgdGhpcy5wcm9ncmVzc2VkQ291bnQrKztcbiAgdGhpcy5oYXNBbnlCcm9rZW4gPSB0aGlzLmhhc0FueUJyb2tlbiB8fCAhaW1hZ2UuaXNMb2FkZWQ7XG4gIC8vIHByb2dyZXNzIGV2ZW50XG4gIHRoaXMuZW1pdEV2ZW50KCAncHJvZ3Jlc3MnLCBbIHRoaXMsIGltYWdlLCBlbGVtIF0gKTtcbiAgaWYgKCB0aGlzLmpxRGVmZXJyZWQgJiYgdGhpcy5qcURlZmVycmVkLm5vdGlmeSApIHtcbiAgICB0aGlzLmpxRGVmZXJyZWQubm90aWZ5KCB0aGlzLCBpbWFnZSApO1xuICB9XG4gIC8vIGNoZWNrIGlmIGNvbXBsZXRlZFxuICBpZiAoIHRoaXMucHJvZ3Jlc3NlZENvdW50ID09IHRoaXMuaW1hZ2VzLmxlbmd0aCApIHtcbiAgICB0aGlzLmNvbXBsZXRlKCk7XG4gIH1cblxuICBpZiAoIHRoaXMub3B0aW9ucy5kZWJ1ZyAmJiBjb25zb2xlICkge1xuICAgIGNvbnNvbGUubG9nKCAncHJvZ3Jlc3M6ICcgKyBtZXNzYWdlLCBpbWFnZSwgZWxlbSApO1xuICB9XG59O1xuXG5JbWFnZXNMb2FkZWQucHJvdG90eXBlLmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG4gIHZhciBldmVudE5hbWUgPSB0aGlzLmhhc0FueUJyb2tlbiA/ICdmYWlsJyA6ICdkb25lJztcbiAgdGhpcy5pc0NvbXBsZXRlID0gdHJ1ZTtcbiAgdGhpcy5lbWl0RXZlbnQoIGV2ZW50TmFtZSwgWyB0aGlzIF0gKTtcbiAgdGhpcy5lbWl0RXZlbnQoICdhbHdheXMnLCBbIHRoaXMgXSApO1xuICBpZiAoIHRoaXMuanFEZWZlcnJlZCApIHtcbiAgICB2YXIganFNZXRob2QgPSB0aGlzLmhhc0FueUJyb2tlbiA/ICdyZWplY3QnIDogJ3Jlc29sdmUnO1xuICAgIHRoaXMuanFEZWZlcnJlZFsganFNZXRob2QgXSggdGhpcyApO1xuICB9XG59O1xuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cblxuZnVuY3Rpb24gTG9hZGluZ0ltYWdlKCBpbWcgKSB7XG4gIHRoaXMuaW1nID0gaW1nO1xufVxuXG5Mb2FkaW5nSW1hZ2UucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggRXZFbWl0dGVyLnByb3RvdHlwZSApO1xuXG5Mb2FkaW5nSW1hZ2UucHJvdG90eXBlLmNoZWNrID0gZnVuY3Rpb24oKSB7XG4gIC8vIElmIGNvbXBsZXRlIGlzIHRydWUgYW5kIGJyb3dzZXIgc3VwcG9ydHMgbmF0dXJhbCBzaXplcyxcbiAgLy8gdHJ5IHRvIGNoZWNrIGZvciBpbWFnZSBzdGF0dXMgbWFudWFsbHkuXG4gIHZhciBpc0NvbXBsZXRlID0gdGhpcy5nZXRJc0ltYWdlQ29tcGxldGUoKTtcbiAgaWYgKCBpc0NvbXBsZXRlICkge1xuICAgIC8vIHJlcG9ydCBiYXNlZCBvbiBuYXR1cmFsV2lkdGhcbiAgICB0aGlzLmNvbmZpcm0oIHRoaXMuaW1nLm5hdHVyYWxXaWR0aCAhPT0gMCwgJ25hdHVyYWxXaWR0aCcgKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBJZiBub25lIG9mIHRoZSBjaGVja3MgYWJvdmUgbWF0Y2hlZCwgc2ltdWxhdGUgbG9hZGluZyBvbiBkZXRhY2hlZCBlbGVtZW50LlxuICB0aGlzLnByb3h5SW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgdGhpcy5wcm94eUltYWdlLmFkZEV2ZW50TGlzdGVuZXIoICdsb2FkJywgdGhpcyApO1xuICB0aGlzLnByb3h5SW1hZ2UuYWRkRXZlbnRMaXN0ZW5lciggJ2Vycm9yJywgdGhpcyApO1xuICAvLyBiaW5kIHRvIGltYWdlIGFzIHdlbGwgZm9yIEZpcmVmb3guICMxOTFcbiAgdGhpcy5pbWcuYWRkRXZlbnRMaXN0ZW5lciggJ2xvYWQnLCB0aGlzICk7XG4gIHRoaXMuaW1nLmFkZEV2ZW50TGlzdGVuZXIoICdlcnJvcicsIHRoaXMgKTtcbiAgdGhpcy5wcm94eUltYWdlLnNyYyA9IHRoaXMuaW1nLnNyYztcbn07XG5cbkxvYWRpbmdJbWFnZS5wcm90b3R5cGUuZ2V0SXNJbWFnZUNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiB0aGlzLmltZy5jb21wbGV0ZSAmJiB0aGlzLmltZy5uYXR1cmFsV2lkdGggIT09IHVuZGVmaW5lZDtcbn07XG5cbkxvYWRpbmdJbWFnZS5wcm90b3R5cGUuY29uZmlybSA9IGZ1bmN0aW9uKCBpc0xvYWRlZCwgbWVzc2FnZSApIHtcbiAgdGhpcy5pc0xvYWRlZCA9IGlzTG9hZGVkO1xuICB0aGlzLmVtaXRFdmVudCggJ3Byb2dyZXNzJywgWyB0aGlzLCB0aGlzLmltZywgbWVzc2FnZSBdICk7XG59O1xuXG4vLyAtLS0tLSBldmVudHMgLS0tLS0gLy9cblxuLy8gdHJpZ2dlciBzcGVjaWZpZWQgaGFuZGxlciBmb3IgZXZlbnQgdHlwZVxuTG9hZGluZ0ltYWdlLnByb3RvdHlwZS5oYW5kbGVFdmVudCA9IGZ1bmN0aW9uKCBldmVudCApIHtcbiAgdmFyIG1ldGhvZCA9ICdvbicgKyBldmVudC50eXBlO1xuICBpZiAoIHRoaXNbIG1ldGhvZCBdICkge1xuICAgIHRoaXNbIG1ldGhvZCBdKCBldmVudCApO1xuICB9XG59O1xuXG5Mb2FkaW5nSW1hZ2UucHJvdG90eXBlLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmNvbmZpcm0oIHRydWUsICdvbmxvYWQnICk7XG4gIHRoaXMudW5iaW5kRXZlbnRzKCk7XG59O1xuXG5Mb2FkaW5nSW1hZ2UucHJvdG90eXBlLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5jb25maXJtKCBmYWxzZSwgJ29uZXJyb3InICk7XG4gIHRoaXMudW5iaW5kRXZlbnRzKCk7XG59O1xuXG5Mb2FkaW5nSW1hZ2UucHJvdG90eXBlLnVuYmluZEV2ZW50cyA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLnByb3h5SW1hZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2xvYWQnLCB0aGlzICk7XG4gIHRoaXMucHJveHlJbWFnZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZXJyb3InLCB0aGlzICk7XG4gIHRoaXMuaW1nLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdsb2FkJywgdGhpcyApO1xuICB0aGlzLmltZy5yZW1vdmVFdmVudExpc3RlbmVyKCAnZXJyb3InLCB0aGlzICk7XG59O1xuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBCYWNrZ3JvdW5kIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vXG5cbmZ1bmN0aW9uIEJhY2tncm91bmQoIHVybCwgZWxlbWVudCApIHtcbiAgdGhpcy51cmwgPSB1cmw7XG4gIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XG4gIHRoaXMuaW1nID0gbmV3IEltYWdlKCk7XG59XG5cbi8vIGluaGVyaXQgTG9hZGluZ0ltYWdlIHByb3RvdHlwZVxuQmFja2dyb3VuZC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBMb2FkaW5nSW1hZ2UucHJvdG90eXBlICk7XG5cbkJhY2tncm91bmQucHJvdG90eXBlLmNoZWNrID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuaW1nLmFkZEV2ZW50TGlzdGVuZXIoICdsb2FkJywgdGhpcyApO1xuICB0aGlzLmltZy5hZGRFdmVudExpc3RlbmVyKCAnZXJyb3InLCB0aGlzICk7XG4gIHRoaXMuaW1nLnNyYyA9IHRoaXMudXJsO1xuICAvLyBjaGVjayBpZiBpbWFnZSBpcyBhbHJlYWR5IGNvbXBsZXRlXG4gIHZhciBpc0NvbXBsZXRlID0gdGhpcy5nZXRJc0ltYWdlQ29tcGxldGUoKTtcbiAgaWYgKCBpc0NvbXBsZXRlICkge1xuICAgIHRoaXMuY29uZmlybSggdGhpcy5pbWcubmF0dXJhbFdpZHRoICE9PSAwLCAnbmF0dXJhbFdpZHRoJyApO1xuICAgIHRoaXMudW5iaW5kRXZlbnRzKCk7XG4gIH1cbn07XG5cbkJhY2tncm91bmQucHJvdG90eXBlLnVuYmluZEV2ZW50cyA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmltZy5yZW1vdmVFdmVudExpc3RlbmVyKCAnbG9hZCcsIHRoaXMgKTtcbiAgdGhpcy5pbWcucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Vycm9yJywgdGhpcyApO1xufTtcblxuQmFja2dyb3VuZC5wcm90b3R5cGUuY29uZmlybSA9IGZ1bmN0aW9uKCBpc0xvYWRlZCwgbWVzc2FnZSApIHtcbiAgdGhpcy5pc0xvYWRlZCA9IGlzTG9hZGVkO1xuICB0aGlzLmVtaXRFdmVudCggJ3Byb2dyZXNzJywgWyB0aGlzLCB0aGlzLmVsZW1lbnQsIG1lc3NhZ2UgXSApO1xufTtcblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0galF1ZXJ5IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vXG5cbkltYWdlc0xvYWRlZC5tYWtlSlF1ZXJ5UGx1Z2luID0gZnVuY3Rpb24oIGpRdWVyeSApIHtcbiAgalF1ZXJ5ID0galF1ZXJ5IHx8IHdpbmRvdy5qUXVlcnk7XG4gIGlmICggIWpRdWVyeSApIHtcbiAgICByZXR1cm47XG4gIH1cbiAgLy8gc2V0IGxvY2FsIHZhcmlhYmxlXG4gICQgPSBqUXVlcnk7XG4gIC8vICQoKS5pbWFnZXNMb2FkZWQoKVxuICAkLmZuLmltYWdlc0xvYWRlZCA9IGZ1bmN0aW9uKCBvcHRpb25zLCBjYWxsYmFjayApIHtcbiAgICB2YXIgaW5zdGFuY2UgPSBuZXcgSW1hZ2VzTG9hZGVkKCB0aGlzLCBvcHRpb25zLCBjYWxsYmFjayApO1xuICAgIHJldHVybiBpbnN0YW5jZS5qcURlZmVycmVkLnByb21pc2UoICQodGhpcykgKTtcbiAgfTtcbn07XG4vLyB0cnkgbWFraW5nIHBsdWdpblxuSW1hZ2VzTG9hZGVkLm1ha2VKUXVlcnlQbHVnaW4oKTtcblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vXG5cbnJldHVybiBJbWFnZXNMb2FkZWQ7XG5cbn0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
