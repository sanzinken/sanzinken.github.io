"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){"function"==typeof define&&define.amd?define(["ev-emitter/ev-emitter"],function(i){return e(t,i)}):"object"==("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e(t,require("ev-emitter")):t.imagesLoaded=e(t,t.EvEmitter)}("undefined"!=typeof window?window:void 0,function(t,e){function i(t,e){for(var i in e)t[i]=e[i];return t}function o(t){var e=[];if(Array.isArray(t))e=t;else if("number"==typeof t.length)for(var i=0;i<t.length;i++)e.push(t[i]);else e.push(t);return e}function n(t,e,r){if(!(this instanceof n))return new n(t,e,r);"string"==typeof t&&(t=document.querySelectorAll(t)),this.elements=o(t),this.options=i({},this.options),"function"==typeof e?r=e:i(this.options,e),r&&this.on("always",r),this.getImages(),h&&(this.jqDeferred=new h.Deferred),setTimeout(function(){this.check()}.bind(this))}function r(t){this.img=t}function s(t,e){this.url=t,this.element=e,this.img=new Image}var h=t.jQuery,a=t.console;n.prototype=Object.create(e.prototype),n.prototype.options={},n.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},n.prototype.addElementImages=function(t){"IMG"==t.nodeName&&this.addImage(t),!0===this.options.background&&this.addElementBackgroundImages(t);var e=t.nodeType;if(e&&m[e]){for(var i=t.querySelectorAll("img"),o=0;o<i.length;o++){var n=i[o];this.addImage(n)}if("string"==typeof this.options.background){var r=t.querySelectorAll(this.options.background);for(o=0;o<r.length;o++){var s=r[o];this.addElementBackgroundImages(s)}}}};var m={1:!0,9:!0,11:!0};return n.prototype.addElementBackgroundImages=function(t){var e=getComputedStyle(t);if(e)for(var i=/url\((['"])?(.*?)\1\)/gi,o=i.exec(e.backgroundImage);null!==o;){var n=o&&o[2];n&&this.addBackground(n,t),o=i.exec(e.backgroundImage)}},n.prototype.addImage=function(t){var e=new r(t);this.images.push(e)},n.prototype.addBackground=function(t,e){var i=new s(t,e);this.images.push(i)},n.prototype.check=function(){function t(t,i,o){setTimeout(function(){e.progress(t,i,o)})}var e=this;this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?this.images.forEach(function(e){e.once("progress",t),e.check()}):this.complete()},n.prototype.progress=function(t,e,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!t.isLoaded,this.emitEvent("progress",[this,t,e]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,t),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&a&&a.log("progress: "+i,t,e)},n.prototype.complete=function(){var t=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(t,[this]),this.emitEvent("always",[this]),this.jqDeferred){var e=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[e](this)}},r.prototype=Object.create(e.prototype),r.prototype.check=function(){this.getIsImageComplete()?this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.proxyImage.src=this.img.src)},r.prototype.getIsImageComplete=function(){return this.img.complete&&void 0!==this.img.naturalWidth},r.prototype.confirm=function(t,e){this.isLoaded=t,this.emitEvent("progress",[this,this.img,e])},r.prototype.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},r.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},r.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},r.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype=Object.create(r.prototype),s.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url,this.getIsImageComplete()&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},s.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype.confirm=function(t,e){this.isLoaded=t,this.emitEvent("progress",[this,this.element,e])},n.makeJQueryPlugin=function(e){(e=e||t.jQuery)&&((h=e).fn.imagesLoaded=function(t,e){return new n(this,t,e).jqDeferred.promise(h(this))})},n.makeJQueryPlugin(),n});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYnJhcmllcy9pbWFnZXNsb2FkZWQuanMiXSwibmFtZXMiOlsid2luZG93IiwiZmFjdG9yeSIsImRlZmluZSIsImFtZCIsIkV2RW1pdHRlciIsIm1vZHVsZSIsIl90eXBlb2YiLCJleHBvcnRzIiwicmVxdWlyZSIsImltYWdlc0xvYWRlZCIsInVuZGVmaW5lZCIsImpRdWVyeSIsImV4dGVuZCIsImEiLCJiIiwicHJvcCIsImFyeSIsIm9iaiIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsImkiLCJwdXNoIiwiSW1hZ2VzTG9hZGVkIiwiZWxlbSIsIm9wdGlvbnMiLCJvbkFsd2F5cyIsInRoaXMiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJtYWtlQXJyYXkiLCJlbGVtZW50cyIsIm9uIiwiZ2V0SW1hZ2VzIiwiJCIsInNldFRpbWVvdXQiLCJEZWZlcnJlZCIsImJpbmQiLCJMb2FkaW5nSW1hZ2UiLCJwcm90b3R5cGUiLCJpbWciLCJCYWNrZ3JvdW5kIiwidXJsIiwiZWxlbWVudCIsImNvbnNvbGUiLCJmb3JFYWNoIiwiYWRkRWxlbWVudEltYWdlcyIsImltYWdlcyIsImJhY2tncm91bmQiLCJub2RlTmFtZSIsImFkZEltYWdlIiwiYWRkRWxlbWVudEJhY2tncm91bmRJbWFnZXMiLCJub2RlVHlwZSIsImNoaWxkSW1ncyIsImVsZW1lbnROb2RlVHlwZXMiLCJjaGlsZCIsImNoaWxkcmVuIiwiMSIsIjExIiwic3R5bGUiLCJnZXRDb21wdXRlZFN0eWxlIiwicmVVUkwiLCJtYXRjaGVzIiwiYWRkQmFja2dyb3VuZCIsImV4ZWMiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJfdGhpcyIsImNoZWNrIiwib25Qcm9ncmVzcyIsImltYWdlIiwibWVzc2FnZSIsImxvYWRpbmdJbWFnZSIsInByb2dyZXNzZWRDb3VudCIsImhhc0FueUJyb2tlbiIsIm9uY2UiLCJjb21wbGV0ZSIsImVtaXRFdmVudCIsInByb2dyZXNzIiwibm90aWZ5IiwiaXNMb2FkZWQiLCJqcURlZmVycmVkIiwiZGVidWciLCJldmVudE5hbWUiLCJpc0NvbXBsZXRlIiwianFNZXRob2QiLCJPYmplY3QiLCJjcmVhdGUiLCJnZXRJc0ltYWdlQ29tcGxldGUiLCJjb25maXJtIiwibmF0dXJhbFdpZHRoIiwicHJveHlJbWFnZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJzcmMiLCJoYW5kbGVFdmVudCIsImV2ZW50IiwibWV0aG9kIiwidHlwZSIsIm9ubG9hZCIsInVuYmluZEV2ZW50cyIsIm9uZXJyb3IiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwibWFrZUpRdWVyeVBsdWdpbiIsImZuIiwiY2FsbGJhY2siLCJwcm9taXNlIl0sIm1hcHBpbmdzIjoib09BTUEsU0FBWUEsRUFBUUMsR0FBWSxtQkFBQUMsUUFBQUEsT0FBQUMsSUFPNUJELFFBSkYseUJBTUssU0FBVUUsR0FKVixPQUFPRixFQUFQRixFQUFpQkksS0FHbEIsV0FBQSxvQkFBQUMsT0FBQSxZQUFBQyxRQUFBRCxVQUNDQSxPQUFVRCxRQUVaQyxPQUpERSxRQUFBTixFQUZGRCxFQVFFUSxRQUFBLGVBT0FSLEVBQU9TLGFBQWVSLEVBSXZCRCxFQUVDQSxFQUFPQSxXQTFCWCxDQThCa0JBLG9CQUFUQyxPQUE2QkQsWUFBdENVLEVBSUEsU0FBZUMsRUFBZlAsR0FVRSxTQUFBUSxFQUFBQyxFQUFBQyxHQUNELElBQUEsSUFBQUMsS0FBQUQsRUFIR0QsRUFBR0UsR0FBU0QsRUFBR0MsR0FNbkIsT0FBQUYsRUFJSUcsU0FBQUEsRUFBQUMsR0FDRCxJQUhERCxLQUlFLEdBQUFFLE1BQUFDLFFBQUFGLEdBRUVELEVBQUFBLE9BQ0QsR0FBQSxpQkFBQUMsRUFBQUcsT0FFRCxJQUFBLElBQUFDLEVBQUEsRUFBQUEsRUFBQUosRUFBQUcsT0FBQUMsSUFDQUwsRUFBSU0sS0FBTUwsRUFBVkksU0FBQUwsRUFBSU0sS0FBTUwsR0FFWixPQUFPRCxFQWNOLFNBQUFPLEVBQUFDLEVBQUFDLEVBQUFDLEdBRUQsS0FBS0MsZ0JBQWVKLEdBQ2xCQyxPQUFBQSxJQUFP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QkFBTCxRQUFBcEQsT0FERmMsRUFBV0YsVUFBVWlELFFBQVUsU0FBVVQsRUFBVVQsR0FLbkQzQyxLQUFBb0QsU0FBQUEsRUFIRXBELEtBQUtpRCxVQUFXLFlBQWNqRCxLQUFNQSxLQUFLZ0IsUUFBUzJCLEtBU2pEL0MsRUFBQThFLGlCQUFBLFNBQUExRixJQUNEQSxFQUFBQSxHQUFBWCxFQUFBVyxXQUtFdUIsRUFBQXZCLEdBVkoyRixHQUFBN0YsYUFBQSxTQUFBZ0IsRUFBQThFLEdBY0FoRixPQURBLElBQUFBLEVBQUFJLEtBQUFGLEVBQUE4RSxHQUNhRixXQUFiRyxRQUFBdEUsRUFBQVAsVUFJQUosRUFBT0EsbUJBQUFBIiwiZmlsZSI6ImxpYnJhcmllcy9pbWFnZXNsb2FkZWQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIGltYWdlc0xvYWRlZCB2NC4xLjNcbiAqIEphdmFTY3JpcHQgaXMgYWxsIGxpa2UgXCJZb3UgaW1hZ2VzIGFyZSBkb25lIHlldCBvciB3aGF0P1wiXG4gKiBNSVQgTGljZW5zZVxuICovXG5cbiggZnVuY3Rpb24oIHdpbmRvdywgZmFjdG9yeSApIHsgJ3VzZSBzdHJpY3QnO1xuICAvLyB1bml2ZXJzYWwgbW9kdWxlIGRlZmluaXRpb25cblxuICAvKmdsb2JhbCBkZWZpbmU6IGZhbHNlLCBtb2R1bGU6IGZhbHNlLCByZXF1aXJlOiBmYWxzZSAqL1xuXG4gIGlmICggdHlwZW9mIGRlZmluZSA9PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQgKSB7XG4gICAgLy8gQU1EXG4gICAgZGVmaW5lKCBbXG4gICAgICAnZXYtZW1pdHRlci9ldi1lbWl0dGVyJ1xuICAgIF0sIGZ1bmN0aW9uKCBFdkVtaXR0ZXIgKSB7XG4gICAgICByZXR1cm4gZmFjdG9yeSggd2luZG93LCBFdkVtaXR0ZXIgKTtcbiAgICB9KTtcbiAgfSBlbHNlIGlmICggdHlwZW9mIG1vZHVsZSA9PSAnb2JqZWN0JyAmJiBtb2R1bGUuZXhwb3J0cyApIHtcbiAgICAvLyBDb21tb25KU1xuICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShcbiAgICAgIHdpbmRvdyxcbiAgICAgIHJlcXVpcmUoJ2V2LWVtaXR0ZXInKVxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgLy8gYnJvd3NlciBnbG9iYWxcbiAgICB3aW5kb3cuaW1hZ2VzTG9hZGVkID0gZmFjdG9yeShcbiAgICAgIHdpbmRvdyxcbiAgICAgIHdpbmRvdy5FdkVtaXR0ZXJcbiAgICApO1xuICB9XG5cbn0pKCB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHRoaXMsXG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICBmYWN0b3J5IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vXG5cbmZ1bmN0aW9uIGZhY3RvcnkoIHdpbmRvdywgRXZFbWl0dGVyICkge1xuXG4ndXNlIHN0cmljdCc7XG5cbnZhciAkID0gd2luZG93LmpRdWVyeTtcbnZhciBjb25zb2xlID0gd2luZG93LmNvbnNvbGU7XG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIGhlbHBlcnMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cblxuLy8gZXh0ZW5kIG9iamVjdHNcbmZ1bmN0aW9uIGV4dGVuZCggYSwgYiApIHtcbiAgZm9yICggdmFyIHByb3AgaW4gYiApIHtcbiAgICBhWyBwcm9wIF0gPSBiWyBwcm9wIF07XG4gIH1cbiAgcmV0dXJuIGE7XG59XG5cbi8vIHR1cm4gZWxlbWVudCBvciBub2RlTGlzdCBpbnRvIGFuIGFycmF5XG5mdW5jdGlvbiBtYWtlQXJyYXkoIG9iaiApIHtcbiAgdmFyIGFyeSA9IFtdO1xuICBpZiAoIEFycmF5LmlzQXJyYXkoIG9iaiApICkge1xuICAgIC8vIHVzZSBvYmplY3QgaWYgYWxyZWFkeSBhbiBhcnJheVxuICAgIGFyeSA9IG9iajtcbiAgfSBlbHNlIGlmICggdHlwZW9mIG9iai5sZW5ndGggPT0gJ251bWJlcicgKSB7XG4gICAgLy8gY29udmVydCBub2RlTGlzdCB0byBhcnJheVxuICAgIGZvciAoIHZhciBpPTA7IGkgPCBvYmoubGVuZ3RoOyBpKysgKSB7XG4gICAgICBhcnkucHVzaCggb2JqW2ldICk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIC8vIGFycmF5IG9mIHNpbmdsZSBpbmRleFxuICAgIGFyeS5wdXNoKCBvYmogKTtcbiAgfVxuICByZXR1cm4gYXJ5O1xufVxuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBpbWFnZXNMb2FkZWQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cblxuLyoqXG4gKiBAcGFyYW0ge0FycmF5LCBFbGVtZW50LCBOb2RlTGlzdCwgU3RyaW5nfSBlbGVtXG4gKiBAcGFyYW0ge09iamVjdCBvciBGdW5jdGlvbn0gb3B0aW9ucyAtIGlmIGZ1bmN0aW9uLCB1c2UgYXMgY2FsbGJhY2tcbiAqIEBwYXJhbSB7RnVuY3Rpb259IG9uQWx3YXlzIC0gY2FsbGJhY2sgZnVuY3Rpb25cbiAqL1xuZnVuY3Rpb24gSW1hZ2VzTG9hZGVkKCBlbGVtLCBvcHRpb25zLCBvbkFsd2F5cyApIHtcbiAgLy8gY29lcmNlIEltYWdlc0xvYWRlZCgpIHdpdGhvdXQgbmV3LCB0byBiZSBuZXcgSW1hZ2VzTG9hZGVkKClcbiAgaWYgKCAhKCB0aGlzIGluc3RhbmNlb2YgSW1hZ2VzTG9hZGVkICkgKSB7XG4gICAgcmV0dXJuIG5ldyBJbWFnZXNMb2FkZWQoIGVsZW0sIG9wdGlvbnMsIG9uQWx3YXlzICk7XG4gIH1cbiAgLy8gdXNlIGVsZW0gYXMgc2VsZWN0b3Igc3RyaW5nXG4gIGlmICggdHlwZW9mIGVsZW0gPT0gJ3N0cmluZycgKSB7XG4gICAgZWxlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIGVsZW0gKTtcbiAgfVxuXG4gIHRoaXMuZWxlbWVudHMgPSBtYWtlQXJyYXkoIGVsZW0gKTtcbiAgdGhpcy5vcHRpb25zID0gZXh0ZW5kKCB7fSwgdGhpcy5vcHRpb25zICk7XG5cbiAgaWYgKCB0eXBlb2Ygb3B0aW9ucyA9PSAnZnVuY3Rpb24nICkge1xuICAgIG9uQWx3YXlzID0gb3B0aW9ucztcbiAgfSBlbHNlIHtcbiAgICBleHRlbmQoIHRoaXMub3B0aW9ucywgb3B0aW9ucyApO1xuICB9XG5cbiAgaWYgKCBvbkFsd2F5cyApIHtcbiAgICB0aGlzLm9uKCAnYWx3YXlzJywgb25BbHdheXMgKTtcbiAgfVxuXG4gIHRoaXMuZ2V0SW1hZ2VzKCk7XG5cbiAgaWYgKCAkICkge1xuICAgIC8vIGFkZCBqUXVlcnkgRGVmZXJyZWQgb2JqZWN0XG4gICAgdGhpcy5qcURlZmVycmVkID0gbmV3ICQuRGVmZXJyZWQoKTtcbiAgfVxuXG4gIC8vIEhBQ0sgY2hlY2sgYXN5bmMgdG8gYWxsb3cgdGltZSB0byBiaW5kIGxpc3RlbmVyc1xuICBzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNoZWNrKCk7XG4gIH0uYmluZCggdGhpcyApKTtcbn1cblxuSW1hZ2VzTG9hZGVkLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEV2RW1pdHRlci5wcm90b3R5cGUgKTtcblxuSW1hZ2VzTG9hZGVkLnByb3RvdHlwZS5vcHRpb25zID0ge307XG5cbkltYWdlc0xvYWRlZC5wcm90b3R5cGUuZ2V0SW1hZ2VzID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuaW1hZ2VzID0gW107XG5cbiAgLy8gZmlsdGVyICYgZmluZCBpdGVtcyBpZiB3ZSBoYXZlIGFuIGl0ZW0gc2VsZWN0b3JcbiAgdGhpcy5lbGVtZW50cy5mb3JFYWNoKCB0aGlzLmFkZEVsZW1lbnRJbWFnZXMsIHRoaXMgKTtcbn07XG5cbi8qKlxuICogQHBhcmFtIHtOb2RlfSBlbGVtZW50XG4gKi9cbkltYWdlc0xvYWRlZC5wcm90b3R5cGUuYWRkRWxlbWVudEltYWdlcyA9IGZ1bmN0aW9uKCBlbGVtICkge1xuICAvLyBmaWx0ZXIgc2libGluZ3NcbiAgaWYgKCBlbGVtLm5vZGVOYW1lID09ICdJTUcnICkge1xuICAgIHRoaXMuYWRkSW1hZ2UoIGVsZW0gKTtcbiAgfVxuICAvLyBnZXQgYmFja2dyb3VuZCBpbWFnZSBvbiBlbGVtZW50XG4gIGlmICggdGhpcy5vcHRpb25zLmJhY2tncm91bmQgPT09IHRydWUgKSB7XG4gICAgdGhpcy5hZGRFbGVtZW50QmFja2dyb3VuZEltYWdlcyggZWxlbSApO1xuICB9XG5cbiAgLy8gZmluZCBjaGlsZHJlblxuICAvLyBubyBub24tZWxlbWVudCBub2RlcywgIzE0M1xuICB2YXIgbm9kZVR5cGUgPSBlbGVtLm5vZGVUeXBlO1xuICBpZiAoICFub2RlVHlwZSB8fCAhZWxlbWVudE5vZGVUeXBlc1sgbm9kZVR5cGUgXSApIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIGNoaWxkSW1ncyA9IGVsZW0ucXVlcnlTZWxlY3RvckFsbCgnaW1nJyk7XG4gIC8vIGNvbmNhdCBjaGlsZEVsZW1zIHRvIGZpbHRlckZvdW5kIGFycmF5XG4gIGZvciAoIHZhciBpPTA7IGkgPCBjaGlsZEltZ3MubGVuZ3RoOyBpKysgKSB7XG4gICAgdmFyIGltZyA9IGNoaWxkSW1nc1tpXTtcbiAgICB0aGlzLmFkZEltYWdlKCBpbWcgKTtcbiAgfVxuXG4gIC8vIGdldCBjaGlsZCBiYWNrZ3JvdW5kIGltYWdlc1xuICBpZiAoIHR5cGVvZiB0aGlzLm9wdGlvbnMuYmFja2dyb3VuZCA9PSAnc3RyaW5nJyApIHtcbiAgICB2YXIgY2hpbGRyZW4gPSBlbGVtLnF1ZXJ5U2VsZWN0b3JBbGwoIHRoaXMub3B0aW9ucy5iYWNrZ3JvdW5kICk7XG4gICAgZm9yICggaT0wOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKysgKSB7XG4gICAgICB2YXIgY2hpbGQgPSBjaGlsZHJlbltpXTtcbiAgICAgIHRoaXMuYWRkRWxlbWVudEJhY2tncm91bmRJbWFnZXMoIGNoaWxkICk7XG4gICAgfVxuICB9XG59O1xuXG52YXIgZWxlbWVudE5vZGVUeXBlcyA9IHtcbiAgMTogdHJ1ZSxcbiAgOTogdHJ1ZSxcbiAgMTE6IHRydWVcbn07XG5cbkltYWdlc0xvYWRlZC5wcm90b3R5cGUuYWRkRWxlbWVudEJhY2tncm91bmRJbWFnZXMgPSBmdW5jdGlvbiggZWxlbSApIHtcbiAgdmFyIHN0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZSggZWxlbSApO1xuICBpZiAoICFzdHlsZSApIHtcbiAgICAvLyBGaXJlZm94IHJldHVybnMgbnVsbCBpZiBpbiBhIGhpZGRlbiBpZnJhbWUgaHR0cHM6Ly9idWd6aWwubGEvNTQ4Mzk3XG4gICAgcmV0dXJuO1xuICB9XG4gIC8vIGdldCB1cmwgaW5zaWRlIHVybChcIi4uLlwiKVxuICB2YXIgcmVVUkwgPSAvdXJsXFwoKFsnXCJdKT8oLio/KVxcMVxcKS9naTtcbiAgdmFyIG1hdGNoZXMgPSByZVVSTC5leGVjKCBzdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgKTtcbiAgd2hpbGUgKCBtYXRjaGVzICE9PSBudWxsICkge1xuICAgIHZhciB1cmwgPSBtYXRjaGVzICYmIG1hdGNoZXNbMl07XG4gICAgaWYgKCB1cmwgKSB7XG4gICAgICB0aGlzLmFkZEJhY2tncm91bmQoIHVybCwgZWxlbSApO1xuICAgIH1cbiAgICBtYXRjaGVzID0gcmVVUkwuZXhlYyggc3R5bGUuYmFja2dyb3VuZEltYWdlICk7XG4gIH1cbn07XG5cbi8qKlxuICogQHBhcmFtIHtJbWFnZX0gaW1nXG4gKi9cbkltYWdlc0xvYWRlZC5wcm90b3R5cGUuYWRkSW1hZ2UgPSBmdW5jdGlvbiggaW1nICkge1xuICB2YXIgbG9hZGluZ0ltYWdlID0gbmV3IExvYWRpbmdJbWFnZSggaW1nICk7XG4gIHRoaXMuaW1hZ2VzLnB1c2goIGxvYWRpbmdJbWFnZSApO1xufTtcblxuSW1hZ2VzTG9hZGVkLnByb3RvdHlwZS5hZGRCYWNrZ3JvdW5kID0gZnVuY3Rpb24oIHVybCwgZWxlbSApIHtcbiAgdmFyIGJhY2tncm91bmQgPSBuZXcgQmFja2dyb3VuZCggdXJsLCBlbGVtICk7XG4gIHRoaXMuaW1hZ2VzLnB1c2goIGJhY2tncm91bmQgKTtcbn07XG5cbkltYWdlc0xvYWRlZC5wcm90b3R5cGUuY2hlY2sgPSBmdW5jdGlvbigpIHtcbiAgdmFyIF90aGlzID0gdGhpcztcbiAgdGhpcy5wcm9ncmVzc2VkQ291bnQgPSAwO1xuICB0aGlzLmhhc0FueUJyb2tlbiA9IGZhbHNlO1xuICAvLyBjb21wbGV0ZSBpZiBubyBpbWFnZXNcbiAgaWYgKCAhdGhpcy5pbWFnZXMubGVuZ3RoICkge1xuICAgIHRoaXMuY29tcGxldGUoKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBmdW5jdGlvbiBvblByb2dyZXNzKCBpbWFnZSwgZWxlbSwgbWVzc2FnZSApIHtcbiAgICAvLyBIQUNLIC0gQ2hyb21lIHRyaWdnZXJzIGV2ZW50IGJlZm9yZSBvYmplY3QgcHJvcGVydGllcyBoYXZlIGNoYW5nZWQuICM4M1xuICAgIHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkge1xuICAgICAgX3RoaXMucHJvZ3Jlc3MoIGltYWdlLCBlbGVtLCBtZXNzYWdlICk7XG4gICAgfSk7XG4gIH1cblxuICB0aGlzLmltYWdlcy5mb3JFYWNoKCBmdW5jdGlvbiggbG9hZGluZ0ltYWdlICkge1xuICAgIGxvYWRpbmdJbWFnZS5vbmNlKCAncHJvZ3Jlc3MnLCBvblByb2dyZXNzICk7XG4gICAgbG9hZGluZ0ltYWdlLmNoZWNrKCk7XG4gIH0pO1xufTtcblxuSW1hZ2VzTG9hZGVkLnByb3RvdHlwZS5wcm9ncmVzcyA9IGZ1bmN0aW9uKCBpbWFnZSwgZWxlbSwgbWVzc2FnZSApIHtcbiAgdGhpcy5wcm9ncmVzc2VkQ291bnQrKztcbiAgdGhpcy5oYXNBbnlCcm9rZW4gPSB0aGlzLmhhc0FueUJyb2tlbiB8fCAhaW1hZ2UuaXNMb2FkZWQ7XG4gIC8vIHByb2dyZXNzIGV2ZW50XG4gIHRoaXMuZW1pdEV2ZW50KCAncHJvZ3Jlc3MnLCBbIHRoaXMsIGltYWdlLCBlbGVtIF0gKTtcbiAgaWYgKCB0aGlzLmpxRGVmZXJyZWQgJiYgdGhpcy5qcURlZmVycmVkLm5vdGlmeSApIHtcbiAgICB0aGlzLmpxRGVmZXJyZWQubm90aWZ5KCB0aGlzLCBpbWFnZSApO1xuICB9XG4gIC8vIGNoZWNrIGlmIGNvbXBsZXRlZFxuICBpZiAoIHRoaXMucHJvZ3Jlc3NlZENvdW50ID09IHRoaXMuaW1hZ2VzLmxlbmd0aCApIHtcbiAgICB0aGlzLmNvbXBsZXRlKCk7XG4gIH1cblxuICBpZiAoIHRoaXMub3B0aW9ucy5kZWJ1ZyAmJiBjb25zb2xlICkge1xuICAgIGNvbnNvbGUubG9nKCAncHJvZ3Jlc3M6ICcgKyBtZXNzYWdlLCBpbWFnZSwgZWxlbSApO1xuICB9XG59O1xuXG5JbWFnZXNMb2FkZWQucHJvdG90eXBlLmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG4gIHZhciBldmVudE5hbWUgPSB0aGlzLmhhc0FueUJyb2tlbiA/ICdmYWlsJyA6ICdkb25lJztcbiAgdGhpcy5pc0NvbXBsZXRlID0gdHJ1ZTtcbiAgdGhpcy5lbWl0RXZlbnQoIGV2ZW50TmFtZSwgWyB0aGlzIF0gKTtcbiAgdGhpcy5lbWl0RXZlbnQoICdhbHdheXMnLCBbIHRoaXMgXSApO1xuICBpZiAoIHRoaXMuanFEZWZlcnJlZCApIHtcbiAgICB2YXIganFNZXRob2QgPSB0aGlzLmhhc0FueUJyb2tlbiA/ICdyZWplY3QnIDogJ3Jlc29sdmUnO1xuICAgIHRoaXMuanFEZWZlcnJlZFsganFNZXRob2QgXSggdGhpcyApO1xuICB9XG59O1xuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cblxuZnVuY3Rpb24gTG9hZGluZ0ltYWdlKCBpbWcgKSB7XG4gIHRoaXMuaW1nID0gaW1nO1xufVxuXG5Mb2FkaW5nSW1hZ2UucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggRXZFbWl0dGVyLnByb3RvdHlwZSApO1xuXG5Mb2FkaW5nSW1hZ2UucHJvdG90eXBlLmNoZWNrID0gZnVuY3Rpb24oKSB7XG4gIC8vIElmIGNvbXBsZXRlIGlzIHRydWUgYW5kIGJyb3dzZXIgc3VwcG9ydHMgbmF0dXJhbCBzaXplcyxcbiAgLy8gdHJ5IHRvIGNoZWNrIGZvciBpbWFnZSBzdGF0dXMgbWFudWFsbHkuXG4gIHZhciBpc0NvbXBsZXRlID0gdGhpcy5nZXRJc0ltYWdlQ29tcGxldGUoKTtcbiAgaWYgKCBpc0NvbXBsZXRlICkge1xuICAgIC8vIHJlcG9ydCBiYXNlZCBvbiBuYXR1cmFsV2lkdGhcbiAgICB0aGlzLmNvbmZpcm0oIHRoaXMuaW1nLm5hdHVyYWxXaWR0aCAhPT0gMCwgJ25hdHVyYWxXaWR0aCcgKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBJZiBub25lIG9mIHRoZSBjaGVja3MgYWJvdmUgbWF0Y2hlZCwgc2ltdWxhdGUgbG9hZGluZyBvbiBkZXRhY2hlZCBlbGVtZW50LlxuICB0aGlzLnByb3h5SW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgdGhpcy5wcm94eUltYWdlLmFkZEV2ZW50TGlzdGVuZXIoICdsb2FkJywgdGhpcyApO1xuICB0aGlzLnByb3h5SW1hZ2UuYWRkRXZlbnRMaXN0ZW5lciggJ2Vycm9yJywgdGhpcyApO1xuICAvLyBiaW5kIHRvIGltYWdlIGFzIHdlbGwgZm9yIEZpcmVmb3guICMxOTFcbiAgdGhpcy5pbWcuYWRkRXZlbnRMaXN0ZW5lciggJ2xvYWQnLCB0aGlzICk7XG4gIHRoaXMuaW1nLmFkZEV2ZW50TGlzdGVuZXIoICdlcnJvcicsIHRoaXMgKTtcbiAgdGhpcy5wcm94eUltYWdlLnNyYyA9IHRoaXMuaW1nLnNyYztcbn07XG5cbkxvYWRpbmdJbWFnZS5wcm90b3R5cGUuZ2V0SXNJbWFnZUNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiB0aGlzLmltZy5jb21wbGV0ZSAmJiB0aGlzLmltZy5uYXR1cmFsV2lkdGggIT09IHVuZGVmaW5lZDtcbn07XG5cbkxvYWRpbmdJbWFnZS5wcm90b3R5cGUuY29uZmlybSA9IGZ1bmN0aW9uKCBpc0xvYWRlZCwgbWVzc2FnZSApIHtcbiAgdGhpcy5pc0xvYWRlZCA9IGlzTG9hZGVkO1xuICB0aGlzLmVtaXRFdmVudCggJ3Byb2dyZXNzJywgWyB0aGlzLCB0aGlzLmltZywgbWVzc2FnZSBdICk7XG59O1xuXG4vLyAtLS0tLSBldmVudHMgLS0tLS0gLy9cblxuLy8gdHJpZ2dlciBzcGVjaWZpZWQgaGFuZGxlciBmb3IgZXZlbnQgdHlwZVxuTG9hZGluZ0ltYWdlLnByb3RvdHlwZS5oYW5kbGVFdmVudCA9IGZ1bmN0aW9uKCBldmVudCApIHtcbiAgdmFyIG1ldGhvZCA9ICdvbicgKyBldmVudC50eXBlO1xuICBpZiAoIHRoaXNbIG1ldGhvZCBdICkge1xuICAgIHRoaXNbIG1ldGhvZCBdKCBldmVudCApO1xuICB9XG59O1xuXG5Mb2FkaW5nSW1hZ2UucHJvdG90eXBlLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmNvbmZpcm0oIHRydWUsICdvbmxvYWQnICk7XG4gIHRoaXMudW5iaW5kRXZlbnRzKCk7XG59O1xuXG5Mb2FkaW5nSW1hZ2UucHJvdG90eXBlLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5jb25maXJtKCBmYWxzZSwgJ29uZXJyb3InICk7XG4gIHRoaXMudW5iaW5kRXZlbnRzKCk7XG59O1xuXG5Mb2FkaW5nSW1hZ2UucHJvdG90eXBlLnVuYmluZEV2ZW50cyA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLnByb3h5SW1hZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2xvYWQnLCB0aGlzICk7XG4gIHRoaXMucHJveHlJbWFnZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZXJyb3InLCB0aGlzICk7XG4gIHRoaXMuaW1nLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdsb2FkJywgdGhpcyApO1xuICB0aGlzLmltZy5yZW1vdmVFdmVudExpc3RlbmVyKCAnZXJyb3InLCB0aGlzICk7XG59O1xuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBCYWNrZ3JvdW5kIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vXG5cbmZ1bmN0aW9uIEJhY2tncm91bmQoIHVybCwgZWxlbWVudCApIHtcbiAgdGhpcy51cmwgPSB1cmw7XG4gIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XG4gIHRoaXMuaW1nID0gbmV3IEltYWdlKCk7XG59XG5cbi8vIGluaGVyaXQgTG9hZGluZ0ltYWdlIHByb3RvdHlwZVxuQmFja2dyb3VuZC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBMb2FkaW5nSW1hZ2UucHJvdG90eXBlICk7XG5cbkJhY2tncm91bmQucHJvdG90eXBlLmNoZWNrID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuaW1nLmFkZEV2ZW50TGlzdGVuZXIoICdsb2FkJywgdGhpcyApO1xuICB0aGlzLmltZy5hZGRFdmVudExpc3RlbmVyKCAnZXJyb3InLCB0aGlzICk7XG4gIHRoaXMuaW1nLnNyYyA9IHRoaXMudXJsO1xuICAvLyBjaGVjayBpZiBpbWFnZSBpcyBhbHJlYWR5IGNvbXBsZXRlXG4gIHZhciBpc0NvbXBsZXRlID0gdGhpcy5nZXRJc0ltYWdlQ29tcGxldGUoKTtcbiAgaWYgKCBpc0NvbXBsZXRlICkge1xuICAgIHRoaXMuY29uZmlybSggdGhpcy5pbWcubmF0dXJhbFdpZHRoICE9PSAwLCAnbmF0dXJhbFdpZHRoJyApO1xuICAgIHRoaXMudW5iaW5kRXZlbnRzKCk7XG4gIH1cbn07XG5cbkJhY2tncm91bmQucHJvdG90eXBlLnVuYmluZEV2ZW50cyA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmltZy5yZW1vdmVFdmVudExpc3RlbmVyKCAnbG9hZCcsIHRoaXMgKTtcbiAgdGhpcy5pbWcucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Vycm9yJywgdGhpcyApO1xufTtcblxuQmFja2dyb3VuZC5wcm90b3R5cGUuY29uZmlybSA9IGZ1bmN0aW9uKCBpc0xvYWRlZCwgbWVzc2FnZSApIHtcbiAgdGhpcy5pc0xvYWRlZCA9IGlzTG9hZGVkO1xuICB0aGlzLmVtaXRFdmVudCggJ3Byb2dyZXNzJywgWyB0aGlzLCB0aGlzLmVsZW1lbnQsIG1lc3NhZ2UgXSApO1xufTtcblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0galF1ZXJ5IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vXG5cbkltYWdlc0xvYWRlZC5tYWtlSlF1ZXJ5UGx1Z2luID0gZnVuY3Rpb24oIGpRdWVyeSApIHtcbiAgalF1ZXJ5ID0galF1ZXJ5IHx8IHdpbmRvdy5qUXVlcnk7XG4gIGlmICggIWpRdWVyeSApIHtcbiAgICByZXR1cm47XG4gIH1cbiAgLy8gc2V0IGxvY2FsIHZhcmlhYmxlXG4gICQgPSBqUXVlcnk7XG4gIC8vICQoKS5pbWFnZXNMb2FkZWQoKVxuICAkLmZuLmltYWdlc0xvYWRlZCA9IGZ1bmN0aW9uKCBvcHRpb25zLCBjYWxsYmFjayApIHtcbiAgICB2YXIgaW5zdGFuY2UgPSBuZXcgSW1hZ2VzTG9hZGVkKCB0aGlzLCBvcHRpb25zLCBjYWxsYmFjayApO1xuICAgIHJldHVybiBpbnN0YW5jZS5qcURlZmVycmVkLnByb21pc2UoICQodGhpcykgKTtcbiAgfTtcbn07XG4vLyB0cnkgbWFraW5nIHBsdWdpblxuSW1hZ2VzTG9hZGVkLm1ha2VKUXVlcnlQbHVnaW4oKTtcblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vXG5cbnJldHVybiBJbWFnZXNMb2FkZWQ7XG5cbn0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
